<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Chess Against a Bot</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.css">
    <style>
        #board {
            width: 400px;
            margin: 20px auto;
        }
        #status {
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1 style="text-align:center;">Play Chess Against a Bot</h1>
    <div id="board" style="width: 400px"></div>
    <div id="status"></div>
    <button id="startBtn">Start Position</button>
    <button id="clearBtn">Clear Board</button>

    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdn.rawgit.com/nmrugg/stockfish.js/2017-10-02/src/stockfish.js"></script>
    
    <script>
        const board = ChessBoard('board', {
            draggable: true,
            position: 'start',
            onDrop: onDrop,
            onSnapEnd: onSnapEnd,
            pieceTheme: {
                'wK': 'https://www.megachess.com/cdn/shop/products/2017_Mega_Chess_Need_to_Clip-52_6b3aa585-ca13-403a-99b5-e848a49922e6.png?v=1535652961',
                'wQ': 'https://upload.wikimedia.org/wikipedia/commons/a/af/Chess_piece_-_White_queen.jpg',
                'wR': 'https://atlas-content-cdn.pixelsquid.com/stock-images/chess-piece-rook-white-chessmen-2MEVBrF-600.jpg',
                'wB': 'https://www.megachess.com/cdn/shop/products/additional_megachess-46_4ca2b004-59ac-4f9e-a3b1-9f4640abcfe6_800x.png?v=1535642863',
                'wN': 'https://images.chesscomfiles.com/uploads/v1/images_users/tiny_mce/MySeT/phpgpiOFN.jpeg',
                'wP': 'https://3.imimg.com/data3/SI/XX/MY-1081084/chess-pawn-500x500.jpg',
                'bK': 'https://www.megachess.com/cdn/shop/products/additional_megachess-8_51ceac04-393d-4374-aaff-ee3a895ab44f_800x.png?v=1535650833',
                'bQ': 'https://e7.pngegg.com/pngimages/697/933/png-clipart-chess-piece-queen-chess-chess-queen-thumbnail.png',
                'bR': 'https://www.megachess.com/cdn/shop/products/additional_megachess-33_95096217-061a-484c-a4a4-a4c914bc84d8_800x.png?v=1535646648',
                'bB': 'https://img.freepik.com/premium-psd/black-bishop-chess-piece-isolated-white-background-3d-render-illustration_989822-148.jpg',
                'bN': 'https://i.pinimg.com/736x/d6/bb/e8/d6bbe8281d97f4a3f169f380f341c0d6.jpg',
                'bP': 'https://blog.chesshouse.com/wp-content/uploads/2014/07/Pawn-Piece.jpg',
            }
        });

        const game = new Chess();
        let stockfish = new Worker('https://cdn.rawgit.com/nmrugg/stockfish.js/2017-10-02/src/stockfish.js');

        stockfish.postMessage('uci');

        stockfish.onmessage = function(event) {
            if (event.data.includes('bestmove')) {
                const move = event.data.split(' ')[1];
                game.move(move);
                board.position(game.fen());
                renderMoveHistory(game.history());
                if (!game.game_over()) {
                    makeBestMove();
                }
            }
        };

        function onDrop(source, target) {
            const move = game.move({
                from: source,
                to: target,
                promotion: 'q' // promote to queen
            });

            removeGreySquares();
            if (move === null) return 'snapback';
            renderMoveHistory(game.history());
            if (!game.game_over()) {
                makeBestMove();
            }
        }

        function onSnapEnd() {
            board.position(game.fen());
        }

        function renderMoveHistory(moves) {
            const historyElement = document.getElementById('status');
            historyElement.innerHTML = 'Moves: ' + moves.join(', ');
        }

        function makeBestMove() {
            stockfish.postMessage('position fen ' + game.fen());
            stockfish.postMessage('go movetime 2000');
        }

        function removeGreySquares() {
            document.querySelectorAll('#board .square-55d63').forEach(square => {
                square.classList.remove('square-55d63');
            });
        }

        document.getElementById('startBtn').addEventListener('click', board.start);
        document.getElementById('clearBtn').addEventListener('click', board.clear);
    </script>
</body>
</html>
